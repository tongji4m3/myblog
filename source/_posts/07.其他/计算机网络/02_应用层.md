---
title: 第二章--应用层
author: tongji4m3
top: false
cover: false
coverImg: /images/1.jpg
toc: true
mathjax: false
summary: '<<计算机网络：自顶向下方法>>读书笔记,第二章--应用层。'
categories: 计算机网络
tags:
  - DNS
  - 应用层
  - HTTP
abbrlink: 3a03a942
date: 2020-11-04 00:00:00
---

# 应用层协议原理

+ 研发网络应用程序的核心是写出能够运行在不同的端系统和通过网络彼此通信的程序

## 进程通信

+ 在一对进程之间的通信会话场景中,发起通信(即在该会话开始时发起与其他进程的联系)的进程被标识为客户,在会话开始时等待联系的进程是服务器
+ 套接字是同一台主机内应用层和运输层之间的接口。
+ 由于套接字是建立在网络应用程序的可编程接口，也称为应用程序和网络之间的应用程序编程接口（API）
+ 开发者对运输层的控制仅限于：1.选择运输层协议 2.设定几个运输层参数，例如最大缓存等
+ 指定**IP地址，端口号**

## 运输服务选择

### 可靠数据传输

当一个运输协议提供这样的服务时，发送进程只要将其数据传递进套接字，就可以完全相信该数据将能无差错地到达接收进程

### 吞吐量

可用吞吐量就是发送进程能够向接收进程交付比特的速率

运输层协议能够以某种特定的速率提供确保的可用吞吐量

具有吞吐量要求的应用程序被称为带宽敏感的应用

### 定时

发送方注入进套接字中的每个比特到达接收方的套接字不迟于`100ms`

对交互式实时应用程序有用

### 安全性

运输协议能加密由发送进程传输的所有数据，并且在发送和接收进程之间提供机密性，防止被其他方式观测到，并且在交付给接收进程之前解密数据

### TCP

#### 面向连接服务

在数据报文流动之前，让客户和服务器互相交换运输层控制信息，提醒客户和服务器做好准备。在握手阶段，一个**TCP连接**就在两个进程的套接字之间建立了

是全双工的，双方可以同时进行报文收发，结束后，必须拆除连接

#### 可靠的数据传送服务

可以无差错，按适当顺序交付所有发送的数据，没有字节的丢失和冗余

### UDP

+ 轻量级运输协议，只提供最小服务、
+ 无连接的，通信前没有握手过程
+ 提供不可靠的数据传送服务，并不保证报文到达接收进程，且可能是乱序到达的

## 应用层协议

+ 定义了运行在不同端系统上的应用程序如何相互传递报文

+ `HTTP`超文本传输协议
+ `SMTP`简单邮件传输协议

# HTTP

服务器向客户发送被请求的文件,而不存储任何关于该客户的状态信息,无状态协议

## 持续连接的HTTP

`HTTP 1.1`持续连接:服务器在发送响应后保存该`TCP`连接打开,在相同的客户和服务器之间,后续的请求和响应报文能够通过相同的连接进行传送

如果一条连接经过一定时间间隔仍未被使用,`HTTP`服务器就会关闭该连接

## cookie

`cookie`用于标识一个用户.用户首次访问一个站点时,可能需要提供一个用户标识.在后续会话中,浏览器向服务器传递一个`cookie`首部,从而向该服务器标识了用户.因此`cookie`可以在无状态的`HTTP`之上建立一个用户会话层

## Web缓存

+ Web缓存器也叫做代理服务器,能够代表初始的`Web`服务器来满足`HTTP`请求的网络实体
+ 它有自己的磁盘存储空间,并在存储空间中保存最近请求过的对象的副本.
+ 可以配置用户的浏览器,使得用户所有的`HTTP`请求首先指向`Web`缓冲器,每个对某对象的浏览器请求首先会把定向到该`Web`缓冲器
+ `Web`缓冲器通常由`ISP`购买并安装,一所大学可能在他的校园网上安装一台缓冲器,并且将所有校园网上的用户浏览器配置为指向他

### 流程

1. 浏览器创建一个到`Web`缓冲器的`TCP`连接
2. `Web`缓冲器进行检查,有副本直接返回
3. 没有则自己打开一个与该对象的初始服务器的`TCP`连接
4. `Web`缓冲器在本地存储副本,并通过现有的`TCP`连接返回给浏览器

### 条件GET方法

用于判断缓存是否修改

1. 代理服务器向Web服务器发送请求,得到对象以及对象的最后修改时间
2. 一个星期后,另一个用户访问该缓存,缓冲区通过条件`GET`执行最新检查
3. 即发送了自己存储的最后修改时间,如果Web服务器发现该对象在指定日期后对该对象修改过,才重新发送该对象,否则只会发送空对象
4. 即`304 Not Modified`,告诉缓冲器,可以使用该对象

# DNS

域名系统,能进行主机名到`IP`地址转换的目录服务

1. 一个由分层的`DNS`服务器实现的分布式数据库
2. 一个使得主机能够查询分布式数据库的应用层协议
3. `DNS`运行在`UDP`上,端口号为53
4. `DNS`是为因特网上的用户应用程序以及其他软件提供一种核心功能,即将主机名转换为其背后的`IP`地址
5. `DNS`通常是由其他应用层协议所使用的,将用户提供的主机名解析为`IP`地址
6. 想获得的`IP`地址通常就缓存在一个附近的`DNS`服务器,有助于减少`DNS`的网络流量和`DNS`的平均时延

## DNS是应用层协议

1. 它使用客户-服务器模式运行在通信的端系统之间
2. 在通信的端系统之间通过下面的端到端运输协议来传送DNS报文

## 请求URL过程

假设一个用户访问`tongji4m3.club/index.html`

1. 同一台用户主机上运行着`DNS`应用的客户端
2. 浏览器从上述`URL`中抽取处主机名`tongji4m3.club`,并将该主机名传给DNS客户端
3. `DNS`客户端会向`DNS`服务器发送一个包含主机名的请求
4. `DNS`客户端会收到一份回答报文,包含对应主机名的`IP`地址
5. 浏览器接收该`IP`地址,向该`IP`地址的80端口的`HTTP`服务器进程发送一个`TCP`连接

## DNS其他服务

+ 主机别名,应用程序可以通过主机别名获得对应的规范主机名和`IP`地址
+ 邮件服务器别名
+ 负载分配:繁忙的站点被冗余分配在多台服务器上,每台服务器都有不同的IP地址,一个`IP`地址集合因此与同一个规范主机名相联系.当客户对映射到某地址集合的名字发出一个`DNS`请求时,该服务器用`IP`地址的整个集合进行响应,但在每个回答中循环这些地址次序

## DNS工作机理概述

### 分布式,层次数据库

+ 没有一台`DNS`服务器拥有因特网上所有主机的映射,这些映射分布在所有的`DNS`服务器上
+ 根`DNS`服务器,根名字服务器提供`TLD`服务器的`IP`地址
+ 顶级域服务器,对应每个顶级域(com,edu,gov等)和所有国家的顶级域(如uk,fr),都有`TLD`服务器
+ 权威DNS服务器,具有公共可访问主机的每个组织机构都必须提供公共可访问的`DNS`记录,将主机名称映射为`IP`地址
+ 本地`DNS`服务器.每个`ISP`都有一台本地`DNS`服务器,起着代理的作用

### DNS记录和报文

`DNS`服务器存储了资源记录(RR),提供了主机名到`IP`地址的映射

资源记录:`(Name,Value,Type,TTL)`

+ TTL是该记录的生存时间,决定RR应当从缓存中删除的时间
+ `Type=A`,则是主机名,IP地址
+ `Type=NS`,则`Name`是一个域,如`foo.com`,而`Value`是知道如何获得该域中主机`IP`地址的权威`DNS`服务器的主机名,用于沿着查询链来路由`DNS`查询
+ 如果`Type=CNAME`,则`Value`是别名为`Name`的主机对应的规范主机名
+ 如果`Type=MX`则`Value`是别名为`Name`的邮件服务器的规范主机名