---
title: 第三章--运输层
author: tongji4m3
top: false
cover: false
coverImg: /images/1.jpg
toc: true
mathjax: false
summary: '<<计算机网络：自顶向下方法>>读书笔记,第三章--运输层。'
categories: 计算机网络
tags:
  - 运输层
  - TCP
  - UDP
abbrlink: 9ec9055a
date: 2020-11-08 00:00:00
---

# 运输层服务

+ 运输层未应用进程提供逻辑通信功能

+ 运输层协议是在端系统中而不是路由器中实现的

+ 在发送端,运输层讲从发送应用程序进程接收到的报文转换成运输层分组,即**报文段**

+ 即将报文分为较小的块,每块假设一个运输层首部,将他们传递给网络层

+ 网络层封装成数据报发送

+ 网络路由器仅作用于该数据报的网络层字段,不检查运输层报文段的字段

+ 有复用和分用两个过程,写信后一切发(复用),收到的回信分发给具体的每个人(分用)

	

## 运输层和网络层的关系

+ 网络层提供了主机之间的逻辑通信,而运输层提供进程之间的逻辑通信
+ 类似于两个家庭之间依靠邮政(网络层)发送邮件,依靠孩子(运输层)分发给家庭中的每个人
+ 运输层协议只工作在端系统中,运输层只负责将来自应用进程的报文移动到网络边缘(网络层),对他在网络核心如何移动并不关心
+ 中间路由器也不识别运输层报文段的任何信息
+ 运输层能够提供的服务常常受限于底层网络层协议的服务模型

## 概述

+ `IP`称为不可靠服务
+ 每台主机至少有一个网络层地址,即`IP`地址
+ 运输层的基本职责就是把两个端系统之间的`IP`的交互服务扩展为运行在端系统上的两个进程之间的交互服务,称为**运输层的多路复用与多路分解**
+ `UDP`只提供进程到进程之间的数据交互和差错检查,是不可靠的服务
+ `TCP`额外提供**可靠数据传输**,**拥塞控制**

## 端口号

+ `16bit`,一共`65536`个
+ 服务端端口号:熟知端口号 `0-1023`,登记端口号`1024-49151`
+ 客户端端口号:仅在客户进程运行时才动态选择的端口号,`49151-65536`

# UDP

## 特点

1. 只提供复用分用,差错检测功能
2. 无连接
3. 不保证可靠交付
4. 面向报文的,适合一次性传输少量数据的网络应用(就是一次发送一个完整的报文,不分成报文段)
5. 无拥塞控制,适合实时应用
6. 首部开销小(`8B`)

## 首部格式

+ 16位源端口号(如果不需要回应则可以全零)
+ 16位目的端口号
+ 16位`UDP`长度,`UDP`报文的整个长度
+ 16位`UDP`校验和,检验整个`UDP`数据报是否有错,错则丢弃

# TCP

+ 面向连接
+ 只能有两个端点,点对点的
+ 可靠有序,不丢不重
+ 提供全双工通信. 有发送缓存(准备发送的数据和已发送但尚未收到确认的数据)和接收缓存
+ 面向字节流.看成无结构的字节流

## 报文段首部格式

### 20B的固定首部

+ 源端口,目的端口
+ 序号:在一个TCP连接中传送的字节流中每一个字节都按顺序编号,本字段表示本报文段所发送数据的第一个字节的序号
+ 确认号:期望收到对方下一个报文段的第一个数据字节的序号.如果确认号为N,代表到序号N-1为止的所有数据都已正确收到
+ 数据偏移(首部长度):TCP报文段的数据起始处距离TCP报文段的起始处有多远,以4B为单位.控制位:`URG`(紧急位,标识优先级),`ACK`(连接建立后所有传送报文段应把他置为1),`PSH`(接收方进行的紧急处理),`RST`(复位,说明出现了严重差错,必须释放连接),`SYN`(同步位,表明是一个连接请求/连接接收报文),`FIN`(此报文段发送方数据已发完,要求释放连接).窗口字段:指发送本报文段的一方的接收窗口,即现在允许对方发送的数据量
+ 校验和:校验首部+数据 紧急指针:`URG=1`时才有意义,指出本报文段中紧急数据的字节数

+ 选项(最大报文段长度MSS,时间戳等) 和 填充字段(为了对齐)

## 连接管理

主动发起连接建立的应用进程叫做客户,被动等待连接建立的应用进程叫做服务器

## 可靠传输

1. 校验,与`UDP`校验一样,增加伪首部
2. 序号,按字节为单位编上序号,根据序号来保证
3. 确认,接收方确定后发一个确认报文段.采用累计确认机制,即前面的必须都收到,不能留空
4. 重传,超时重传,重传时间 自适应算法,动态改变重传时间`RTTs`(加权平均往返时间) ,每当比期望序号大的失序报文段到达时,会发送冗余`ACK`,指明下一个期待字节的序号

## 流量控制

+ 利用**滑动窗口**机制实现流量控制
+ 接收方根据自己接收缓存的大小,动态调整窗口字段`rwnd`给发送方
+ 发送方的发送窗口取决于窗口字段`rwnd`和拥塞窗口`cwnd`的最小值

## 拥塞控制

### 假设

1. 假定数据单方向传送,而另一个方向只传送确认
2. 接收方总是有足够大的缓存空间,因此发送窗口大小取决于拥塞程度,拥塞窗口是发送方设置的,反映的是自己估算的网络拥塞程度

### 慢开始和拥塞避免

### 快重传和快恢复







