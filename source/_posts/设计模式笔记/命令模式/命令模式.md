---
title: 设计模式--命令模式
author: tongji4m3
top: false
cover: false
coverImg: /images/1.jpg
toc: true
mathjax: false
summary: '学习《Head Frist 设计模式》所做的笔记,主要介绍了命令模式的原则,类图,代码实现。'
categories: 设计模式笔记
tags:
  - 设计模式
  - Java
  - UML
abbrlink: e41403a7
date: 2020-10-06 00:00:00
---

# 命令模式

## 定义

命令模式将请求封装成对象,以便使用不同的请求,队列或者日志来参数化其他对象。命令模式也支持可撤销的操作

## 细节

+ 可将动作的请求者和动作的执行者对象中解耦
+ 一个命令对象通过在特定接收者上绑定一组对象来封装一个请求，它将动作和接收者包进对象中。
+ 使用栈存储操作过程的每一个命令，即可不断地实现撤销功能
+ 可支持宏命令，即将一系列命令封装到一个命令对象中执行

## 类图

![命令模式类图](https://tongji4m3.oss-cn-beijing.aliyuncs.com/image-20201004105520644.png)

# 简单遥控器实现

## Command

```java
public interface Command
{
    void execute();
}
```

```java
public class LightOnCommand implements Command
{
    Light light;

    public LightOnCommand(Light light)
    {
        this.light = light;
    }

    @Override
    public void execute()
    {
        light.on();
    }
}
```

## Light

```java
public class Light
{
    public void on()
    {
        System.out.println("light on");
    }

    public void off()
    {
        System.out.println("light off");
    }
}
```

## SimpleRemoteControl

```java
public class SimpleRemoteControl
{
    Command slot;

    public SimpleRemoteControl()
    {
    }

    public void setCommand(Command command)
    {
        slot = command;
    }
    public void buttonWasPressed()
    {
        slot.execute();
    }
}
```
## RemoteControlTest
```java
public class RemoteControlTest
{
    public static void main(String[] args)
    {
        SimpleRemoteControl remote = new SimpleRemoteControl();
        Light light = new Light();
        LightOnCommand lightOnCommand = new LightOnCommand(light);
        remote.setCommand(lightOnCommand);
        remote.buttonWasPressed();
    }
}
```

# 真正的遥控器

## Light

```java
public class Light
{
    private String name;

    public Light()
    {
    }

    public Light(String name)
    {
        this.name = name;
    }

    public void on()
    {
        System.out.println("light on " + this.name);
    }

    public void off()
    {
        System.out.println("light off " + this.name);
    }
}
```

## command

```java
public interface Command
{
    void execute();

    void undo();
}
```

```java
public class LightOnCommand implements Command
{
    Light light;

    public LightOnCommand(Light light)
    {
        this.light = light;
    }

    @Override
    public void execute()
    {
        light.on();
    }

    public void undo()
    {
        light.off();
    }
}
```

```java
public class LightOffCommand implements Command
{
    Light light;

    public LightOffCommand(Light light)
    {
        this.light = light;
    }

    @Override
    public void execute()
    {
        light.off();
    }

    public void undo()
    {
        light.on();
    }
}
```

```java
public class NoCommand implements Command
{
    @Override
    public void execute()
    {
        System.out.println("No Command");
    }

    @Override
    public void undo()
    {
        System.out.println("No Command");
    }
}
```

## RemoteControl

```java
public class RemoteControl
{
    private Command[] onCommands;
    private Command[] offCommands;
    private Command undoCommand;//用于实现撤销操作

    public RemoteControl()
    {
        onCommands = new Command[7];
        offCommands = new Command[7];

        Command noCommand = new NoCommand();
        for (int i = 0; i < 7; i++)
        {
            onCommands[i] = noCommand;
            offCommands[i] = noCommand;
        }
        undoCommand = noCommand;
    }

    //留待以后扩展指令
    public void setCommand(int slot,Command onCommand,Command offCommand)
    {
        onCommands[slot] = onCommand;
        offCommands[slot] = offCommand;
    }

    public void onButtonWasPushed(int slot)
    {
        onCommands[slot].execute();
        undoCommand = onCommands[slot];
    }
    public void offButtonWasPushed(int slot)
    {
        offCommands[slot].execute();
        undoCommand = offCommands[slot];
    }

    public void undoButtonWasPushed()
    {
        undoCommand.undo();
    }

    @Override
    public String toString()
    {
        return "RemoteControl{" +
                "onCommands=" + Arrays.toString(onCommands) +
                ", offCommands=" + Arrays.toString(offCommands) +
                '}';
    }
}
```

## RemoteLoader

```java
public class RemoteLoader
{
    public static void main(String[] args)
    {
        RemoteControl remoteControl = new RemoteControl();
        Light livingRoomLight = new Light("Living Room");
        Light kitchenLight = new Light("Kitchen");

        LightOnCommand livingOnCommand = new LightOnCommand(livingRoomLight);
        LightOffCommand livingOffCommand = new LightOffCommand(livingRoomLight);
        LightOnCommand kitchenOnCommand = new LightOnCommand(kitchenLight);
        LightOffCommand kitchenOffCommand = new LightOffCommand(kitchenLight);

        remoteControl.setCommand(0, livingOnCommand, livingOffCommand);
        remoteControl.setCommand(1, kitchenOnCommand, kitchenOffCommand);

        remoteControl.onButtonWasPushed(0);
        remoteControl.offButtonWasPushed(0);
        remoteControl.undoButtonWasPushed();

        System.out.println("------------------------");
        remoteControl.onButtonWasPushed(1);
        remoteControl.offButtonWasPushed(1);
        remoteControl.undoButtonWasPushed();

        /*
        light on Living Room
        light off Living Room
        light on Living Room
        ------------------------
        light on Kitchen
        light off Kitchen
        light on Kitchen
         */

    }
}
```

