---
title: 设计模式--观察者模式
author: tongji4m3
top: false
cover: false
coverImg: /images/1.jpg
toc: true
mathjax: false
summary: '学习《Head Frist 设计模式》所做的笔记,主要介绍了观察者模式的原则,类图,代码实现。'
categories: 设计模式笔记
tags:
  - 设计模式
  - Java
  - UML
abbrlink: 98ef9b01
date: 2020-09-18 00:00:00
---

# 观察者模式
## 定义

观察者模式定义了对象之间的一对多依赖,这样一来,当一个对象改变状态时,他的所有依赖者都会收到通知并自动更新。

## 细节

主题只知道观察者实现了Observer接口。在任何时候我们都可以增加新的观察者，因为主题唯一依赖的东西是一个实现了Observer接口的对象列表。

有新类型观察者出现时，只需要实现观察者接口，再注册成为观察者即可。

## 设计原则

为了交互对象之间的松耦合设计而努力

## 类图

![image-20200924112457998](https://tongji4m3.oss-cn-beijing.aliyuncs.com/image-20200924112457998.png)

# 实现

## Subject接口相关

```java
public interface Subject
{
    void registerObserver(Observer observer);

    void removeObserver(Observer observer);

    void notifyObservers();
}
```

```java
public class WeatherData implements Subject
{
    private final List<Observer> observers;
    private float temperature;
    private float humidity;
    private float pressure;

    public WeatherData()
    {
        observers = new ArrayList<>();
    }

    @Override
    public void registerObserver(Observer observer)
    {
        observers.add(observer);
    }

    @Override
    public void removeObserver(Observer observer)
    {
        observers.remove(observer);
    }

    @Override
    public void notifyObservers()
    {
        for (Observer observer : observers)
        {
            observer.update(temperature,humidity,pressure);
        }
    }

    public void measurementsChanged()
    {
        notifyObservers();
    }

    public void setMeasurements(float temperature,float humidity,float pressure)
    {
        this.temperature = temperature;
        this.humidity = humidity;
        this.pressure = pressure;
        measurementsChanged();
    }
}
```

## Observer接口相关

```java
public interface Observer
{
    void update(float temp, float humidity, float pressure);
}
```

```java
public interface DisplayElement
{
    void display();
}
```

```java
public class CurrentConditionsDisplay implements Observer, DisplayElement
{
    private float temperature;
    private float humidity;
    private Subject weatherData;

    public CurrentConditionsDisplay(Subject weatherData)
    {
        this.weatherData = weatherData;
        weatherData.registerObserver(this);
    }

    @Override
    public void display()
    {
        System.out.println("CurrentConditionsDisplay:"+temperature+","+humidity);
    }

    @Override
    public void update(float temperature, float humidity, float pressure)
    {
        this.temperature = temperature;
        this.humidity = humidity;
        display();
    }
}
```

```java
public class ForecastDisplay implements Observer, DisplayElement
{
    private float temperature;
    private float humidity;
    private float pressure;
    private Subject weatherData;

    public ForecastDisplay(Subject weatherData)
    {
        this.weatherData = weatherData;
        weatherData.registerObserver(this);
    }

    @Override
    public void display()
    {
        System.out.println("ForecastDisplay:"+temperature+","+humidity+","+pressure);
    }

    @Override
    public void update(float temperature, float humidity, float pressure)
    {
        this.temperature = temperature;
        this.humidity = humidity;
        this.pressure = pressure;
        display();
    }
}
```

```java
public class StatisticsDisplay implements Observer, DisplayElement
{
    private float temperature;
    private float humidity;
    private float pressure;
    private Subject weatherData;

    public StatisticsDisplay(Subject weatherData)
    {
        this.weatherData = weatherData;
        weatherData.registerObserver(this);
    }

    @Override
    public void display()
    {
        System.out.println("StatisticsDisplay:"+temperature+","+humidity+","+pressure);
    }

    @Override
    public void update(float temperature, float humidity, float pressure)
    {
        this.temperature = temperature;
        this.humidity = humidity;
        this.pressure = pressure;
        display();
    }
}
```

## MainTest

```java
public class MainTest
{
    public static void main(String[] args)
    {
        WeatherData weatherData = new WeatherData();
        CurrentConditionsDisplay currentConditionsDisplay = new CurrentConditionsDisplay(weatherData);
        ForecastDisplay forecastDisplay = new ForecastDisplay(weatherData);
        StatisticsDisplay statisticsDisplay = new StatisticsDisplay(weatherData);
        weatherData.setMeasurements(80,65,30.4f);
        /*
        输出:
        CurrentConditionsDisplay:80.0,65.0
        ForecastDisplay:80.0,65.0,30.4
        StatisticsDisplay:80.0,65.0,30.4
         */
    }
}
```