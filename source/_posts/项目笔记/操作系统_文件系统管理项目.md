---
title: 项目------操作系统_文件管理项目
author: tongji4m3
top: false
cover: false
coverImg: /images/1.jpg
toc: true
mathjax: false
summary: 操作系统_文件管理项目。一个简单的Java项目，主要是模拟操作系统的文件管理过程。
categories: 项目文档
tags:
  - Java
  - 操作系统
  - 文件管理
abbrlink: 1c948532
date: 2020-05-25 00:00:00
---

#  [文件管理源码_Github地址](https://github.com/tongji4m3/fileSystem)
>图片太多,上传之后有些位置错乱或者不显示,可以在源码地址查看word版本

# 项目目的

-   理解文件存储空间的管理；

-   掌握文件的物理结构、目录结构和文件操作；

-   实现简单文件系统管理；

-   加深文件系统实现过程的理解；

# 项目需求

##  基本要求

-   在内存中开辟一个空间作为文件存储器，在其上实现一个简单的文件系统;

-   退出这个文件系统时，需要该文件系统的内容保存到磁盘上，以便下次可以将其回复到内存中来。

## 具体要求

-   文件存储空间管理可采取显式链接（如FAT）或者其他方法；

-   空闲空间管理可采用位图或者其他方法；

-   文件目录采用多级目录结构，目录项目中应包含：文件名、物理地址、长度等信息。

## 文件系统提供的操作

    -   格式化
    
    -   创建子目录
    
    -   删除子目录
    
    -   显示目录
    
    -   更改当前目录
    
    -   创建文件
    
    -   打开文件
    
    -   关闭文件
    
    -   写文件
    
    -   读文件
    
    -   删除文件

#  项目设计及算法

## 项目整体结构

本项目是windows平台下,采用java语言开发的，通过命令行互动的文件管理项目。主要采用MVC架构模式,分为三个包(model,view,controller),和一个主类Main。通过主类调用view包下的View类开启命令行交互进行文件管理。

model包下放置了一些实体类以及常量结合。其中的Const存放一些公共参数，例如物理块的大小，容量等等。FCB类则代表一个文件目录项的实体，存储一些文件名，文件属性，文件物理块地址等信息。Block类则充当了磁盘物理块实体，它存储了物理块地址和数据。

view包下主要负责和用户进行命令行交互的全部内容，对于用户输入的指令进行判断，并且调用controller以及model包下的类完成功能。例如用户输入ls指令，在View类中，就会判断该指令，并且调用controller得到当前目录，然后得到该目录的所有子目录，再将之按照特定的格式打印并呈现给用户。

controller包下包含了两个类：Controller，IOController。其中Controller负责对目录区，文件区，FAT，位示图，打开文件表等进行相应的管理，包括分配释放等操作。IOController负责读写文件，并且负责初始时从电脑本地磁盘回复内容到内存（即此虚拟文件管理系统中），还负责退出文件系统时，把文件系统内容保存在电脑本地磁盘中。



## 项目实现思路

首先，当退出程序时，将用来模拟物理块，PCB等数组存储在本地文件之中，而启动程序时，则从本地文件中读取相应的数据，以此达到备份的目的。

然后，该文件系统主要分为目录位示图，文件位示图，FAT，目录区，文件区五部分组成。文件目录采用多级目录结构。文件存储空间管理采取显式链接管理（FAT），空闲空间管理采用位示图管理。

目录区为FCB组成的数组。其中每个文件（目录或者文件）对应一个FCB，每个FCB都存储了文件名，文件类型，物理块号，父路径，子目录等信息。而目录区物理块分配与否通过目录的位示图标识。

文件区为Block组成的数组，存储了物理块号以及实际的文件数据。分配文件时,则扫描位示图,找到N个0,并且计算出对应的盘块号,将之分配给文件。并且在FAT中，以静态链接的形式标识出分配的物理块顺序。

程序一直会存储当前路径（即某个FCB）,并且初始化为根路径/，而进行操作时，可以有两种方式：绝对路径，相对路径。相对路径则根据当前路径进行操作。而绝对路径方式，则从目录区获取根路径/的PCB，然后按照层级进行操作。程序还存储一个打开文件表，当打开，读写文件时，就会将文件加入到打开文件表。

## 文件系统可用指令

其中，涉及fileName的指令，fileName都可以有两种写法，一种是从根路径开始的绝对路径写法，例如/usr/local；另外一种是从当前路径开始，例如，temp。

从本地磁盘加载与保存文件是系统自动进行的。如果想要到初始环境，可以执行format指令。

-   退出 exit

-   查看帮助 –help

-   格式化 format

-   显示目录 pwd

-   更改当前目录 cd fileName

-   创建子目录 mkdir fileName

-   删除子目录 rm fileName

-   列出当前目录下所有文件 ls

-   创建文件 touch fileName

-   打开文件 open fileName

-   关闭文件 close fileName

-   写文件 vim fileName

-   读文件 cat fileName

-   删除文件 delete fileName

-   查看目录区信息 dirBlock

-   查看文件区信息 fileBlock

-   查看打开文件表 openFiles

# 项目实现

## Main类实现

>   Main类只是整个程序的入口，他通过new
>   View（）调用View类执行文件系统主要的逻辑。

##  model包下类的实现

###  Const类的实现

>   Const类存储了程序用到的所有常量,放在一起,便于程序的维护。首先，用DIR=1，FILE=0来标识文件类型，之后可以直接引用，不需要记住是0还是1。随后，记录了目录区物理块数量，以及目录区位示图的尺寸。最后，记录了文件区物理块数量，容量，以及文件区位示图的尺寸。

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly90b25namk0bTMub3NzLWNuLWJlaWppbmcuYWxpeXVuY3MuY29tLzZhYjJmOTAxZGFjMTU2MTZjMjZiNGM5ZmI4ZDlhNTEyLnBuZw?x-oss-process=image/format,png)

### FCB的实现

>   一个FCB代表了一个目录项。所以FCB包含以下属性：文件名称（即相对路径名称），文件路径（即绝对路径名称），文件类型（File或者Dir），文件物理块地址，文件物理块长度，文件的子目录（只有文件类型为Dir才有），文件的父路径。


>   其中有以下实用函数：

>   getChildren（String
>   childName）:从该FCB的子目录中查找名称为childName的文件并返回，如果不存在则返回null。

>   remove（String childName）:删除名称为childName的文件并返回删除结果。

>   toString（）:通过使用String.format函数，按照阅读良好的格式输出该FCB。

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly90b25namk0bTMub3NzLWNuLWJlaWppbmcuYWxpeXVuY3MuY29tLzVhZWM1MTllYTcxMjE0NDE0MWUzYWQ0ZWM4OTAwNzBlLnBuZw?x-oss-process=image/format,png)

###   Block类的实现

>   Block主要是模拟文件区的物理块。有两个属性：id和data，id代表该块的编号，data为ByteBuffer类型，存储了文件实际的试卷。

## view包下类的实现

>   view包只有一个类View，但是里面有很多函数来实现和用户的交互功能。他有两个成员变量：controller以及ioController，负责调用Controller包下的两个类进行文件管理的具体操作。

### 初始化函数View（）

>   在初始化时，会先从本地磁盘加载上一次退出时文件系统的数据。随后不断接收用户输入的数据，并且根据用户的指令调用相应的函数进行文件管理。值得注意的是，指令有两种模式，一种是equals（），例如exit指令，只有仅仅输入exit时，才会执行相应操作。另外一种是startWith（）模式，会将所有以此开头的指令相匹配，例如mkdir
>   /usr/local命令就用到这种模式。而且equals模式放在了startWith模式之前，防止一些匹配错误的问题。最后，还在每次输入指令时，显示了当前的用户和路径。

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly90b25namk0bTMub3NzLWNuLWJlaWppbmcuYWxpeXVuY3MuY29tLzU1YzU1ZjRjODIwNWIxNTI5YjZkOTY0NDVjOTQ5NjFiLnBuZw?x-oss-process=image/format,png)

### 函数exit（）

>   退出时，调用ioController.save()方法，将本次文件系统的内容保存在本地硬盘中。

### 函数format（）

>   其实就是另外一次初始化，且不加载磁盘中的文件。主要就是将controller，ioController重新初始化。

### 函数help（）

>   通过输入—help，进入该函数，打印本文件系统所支持的所有操作。

###  getCurrentFCB(String command)

>   一个重要的公共函数，负责从command中获取文件的FCB。例如指令mkdir
>   /usr/local。首先，会将指令按照空格分隔，并且进行有效性检验。随后根据后者的路径是否以/开头进行不同的操作，如果是/开头，则从根目录开始不断查找到它，如果不是，则从当前路径的子目录进行查找。最后将之返回，如果不存在，则返回null。


###  checkFileName(String fileName)

>   检验文件名合法性的公共函数，通过正则表达式判断文件名是否合法。

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly90b25namk0bTMub3NzLWNuLWJlaWppbmcuYWxpeXVuY3MuY29tLzQ4NTFjNzU3NTQzOGRiMTY2NTY4YjU3YjY1YjQyZjg2LnBuZw?x-oss-process=image/format,png)

###  create(String command, int type)

>   该函数可根据指令创建文件或者命令。首先还是把命令拆分得到文件路径，并且根据是否以/开头执行不同操作，而之后又根据是文件或目录执行不同的创建操作。如果是以/开头，则还是先得到根路径，随后将路径按照/拆分。以/usr/local/temp.txt为例：将之拆分为usr，local，temp.txt。首先校验文件名是否合法。随后如果路径是存在的，则进入路径，例如如果原来存在usr文件夹，则进入，而local文件夹不存在，则创建文件夹（先通过目录位示图得到空闲目录块地址，再将目录磁盘块分配给他，还要新建FCB，并且在他的父路径的子目录中添加他）。随后，又发现temp.txt文件不存在，则创建他（在位示图中分配，在FAT中分配，新建该文件的FCB，另他父路径的子目录添加该FCB）。

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly90b25namk0bTMub3NzLWNuLWJlaWppbmcuYWxpeXVuY3MuY29tL2Y3MGU5M2ZkNjE5NjZhZDA3MWJkZGE3ZmNhMTZkMjZmLnBuZw?x-oss-process=image/format,png)

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly90b25namk0bTMub3NzLWNuLWJlaWppbmcuYWxpeXVuY3MuY29tL2Q1NTNlY2IwNGNiN2RhMmJjZmFlYmIzZmNjODNhMWQwLnBuZw?x-oss-process=image/format,png)

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly90b25namk0bTMub3NzLWNuLWJlaWppbmcuYWxpeXVuY3MuY29tLzllZjdlNGI0MmY5YjY5MmQ5MWYyYzViN2Y4MGUzMWIzLnBuZw?x-oss-process=image/format,png)

###  delete(String command)

>   通过调用getCurrentFCB(command)指令得到该指令里的文件的FCB，如果文件名不对则提示并且返回。随后在打开文件表中删除，在位示图移除，在磁盘块删除，在FCB目录中移除，在FAT中回收。

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly90b25namk0bTMub3NzLWNuLWJlaWppbmcuYWxpeXVuY3MuY29tLzViNzUzY2RlYTg1YzhmNDQ5ZWVmZjM3NjgwMTg0ZjI4LnBuZw?x-oss-process=image/format,png)

###  write(String command)

>   负责写入文件内容，如果文件不存在会先创建一个。随后通过调用getCurrentFCB(command)指令得到该指令里的文件的FCB，如果文件名不对则提示并且返回。然后首先加入打开文件表，之后将用户输入暂存与StringBuilder中，再调用ioController.write()将输入内容写入文件对应的物理磁盘块中。

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly90b25namk0bTMub3NzLWNuLWJlaWppbmcuYWxpeXVuY3MuY29tLzdmODEwYTQwZjRhNTYxZjU5ZmEzZmY5NDJkZjQxZjVhLnBuZw?x-oss-process=image/format,png)

###  read(String command)

>   负责读取文件内容。通过调用getCurrentFCB(command)指令得到该指令里的文件的FCB，如果文件名不对则提示并且返回。然后首先加入打开文件表，通过ioController.read()将文件内容显示到屏幕上。

###  open(),close()函数

>   通过调用getCurrentFCB(command)指令得到该指令里的文件的FCB，如果文件名不对则提示并且返回。将文件添加或者移除打开文件表。

###  rm(String command)函数

>   通过调用getCurrentFCB(command)指令得到该指令里的文件的FCB，如果文件名不对则提示并且返回。并且调用rmRecursive（FCB
>   fcb）将他的子目录以及文件都删除（如果还是目录，则继续调用自己，递归删除所有文件）。最后，再将他本身删除。（在FCB中删除，在目录的位示图中删除，在目录磁盘块中删除）。



###  cd(String command)

>   照例，先将命令拆分，得到路径。然后需要判断路径是否是.. ../ ./
>   .等执行特殊操作。若不是，则通过调用getCurrentFCB(command)指令得到该指令里的文件的FCB，如果文件名不对，或者不是目录则提示并且返回。然后将当前路径设为该FCB。


###  ls（）函数

>   首先得到当前路径的子目录，然后全部打印。因为前面说过重写了FCB的toString（）方法，所以格式良好。

###  其他函数

>   pwd（）函数得到controller的当前目录的路径名，并且打印。openFiles()获取controller的打开文件表，并且展示打开文件表中文件名以及占用的物理块号。fileBlock()，dirBlock()则根据文件/目录的位示图，判断出已经使用的磁盘块，并且展示。


 ##  controller包下类的实现

 ###   Controller类

>   成员函数包括：当前的目录项，目录区磁盘块，文件区磁盘块，文件分配表FAT。目录的空闲分区位示图，文件的空闲分区位示图以及打开文件表。

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly90b25namk0bTMub3NzLWNuLWJlaWppbmcuYWxpeXVuY3MuY29tLzhkZWUyMTc3YzM2ZjdmNzQzYmIzYmEyYWFiNzJkMmJkLnBuZw?x-oss-process=image/format,png)

####   初始化函数Controller（）：

>   将上述的成员变量初始化。值得注意的是，在FAT中,-1代表结束,其他数字代表下一个物理块指向,所以初始化为-2。并且为根路径分配目录区的物理块0，并且设置为当前目录。


####   allocFAT()与freeFAT()：

>   负责FAT的分配与回收，根据之前分配给文件的物理块地址链表，在FAT中进行分配，且FAT的值为下一个物理块索引，最后一块值为-1。回收则是传入文件的起始物理块，随后一直根据FAT中的值寻找到下一个物理块，并且置为-2（未分配状态）。

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly90b25namk0bTMub3NzLWNuLWJlaWppbmcuYWxpeXVuY3MuY29tL2RlNGY3ZmNmY2Y4ZGQyNGIxNzlmNGQ2YzY0NWZmMGQ5LnBuZw?x-oss-process=image/format,png)

####   getFreeDirBlock()与setFreeDirBlock(int dirIndex)：

>   负责目录位示图的分配与回收操作。从位示图选取一个未分配的，通过数学转换成一维的目录块索引，并且标记为已分配。而回收则把目录磁盘块索引转为二维位示图坐标，标记为未分配。

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly90b25namk0bTMub3NzLWNuLWJlaWppbmcuYWxpeXVuY3MuY29tLzE4ODVjYjdkODRiMjAxNDM1ZTZjY2VlZjM1MDhkMDI2LnBuZw?x-oss-process=image/format,png)

####  getFreeFileBlock(int size)与setFreeFileBlock(int dirIndex)：

>   负责文件位示图的分配与回收操作。需要传入文件块的大小，以便分配足够的文件物理块。从位示图选取size个未分配的，通过数学转换成一维的文件块索引，并且标记为已分配，返回索引链表。而回收则把文件磁盘块索引转为二维位示图坐标，标记为未分配。

####   addOpenFiles(String address,Integer blockIndex)
>   负责加入与移除打开文件表。实现很简单，加入就往map中加入键值对（文件的地址，文件起始物理块号）。删除则根据文件地址删除键值对。


 ###    IOController类

IOController类负责读写文件，并且负责初始时从电脑本地磁盘回复内容到内存（即此虚拟文件管理系统中），还负责退出文件系统时，把文件系统内容保存在电脑本地磁盘中。该类有一个成员变量controller，以获取Controller提供的一些功能。

####  write（）与read（）函数：

负责文件内容的读写，读写都需要传入要操作的文件的PCB，然后写还需要传入写入的文本。随后写则在文件区中寻找该PCB所对应的物理块，并且对他的data区域进行写操作。读操作也是找到对应的物理块进行读操作。

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly90b25namk0bTMub3NzLWNuLWJlaWppbmcuYWxpeXVuY3MuY29tL2FkNDQ0YmQ5NGIwMWE3Zjc0ZDVhMjg3Njg1Y2JiNWMzLnBuZw?x-oss-process=image/format,png)

####  load（）与save（）函数：

>   负责将文件系统加载与保存于本地磁盘中。他们是成对的。通过调用函数，他们保存与加载了文件系统中的目录位示图，文件位示图，FAT，目录物理块，文件物理块。基本的操作都是将当前文件系统中的数据按照约定格式写在磁盘中特定的文件中，然后下次启动时，则从这些文件中按之前的格式读取数据并且给他们赋值。



#### saveBits（）与loadBits（）函数：

>   首先在本地建立文件bits，随后将controller中的文件位示图一行行写入文件中。而恢复则从bits文件一行行赋值给初始的文件位示图bits。


#### saveDirBits（）与loadDirBits（）函数：

>   与文件位示图的保存恢复差不多。都是首先在本地建立文件dirBits，随后将controller中的目录位示图一行行写入文件中。而恢复则从dirBits文件一行行赋值给初始的目录位示图bits。

#### saveDirArea（）与loadDirArea（）函数：

也是创建一个文件dirArea来存储数据。策略是按照深度优先搜索算法递归的存储目录信息，并且存储文件所在层级（根目录的层级是0，它所有子目录下文件层级是1，以此类推）。而从已经存储好的目录数据中加载数据时，则一行行的加载目录数据，根据层级重建目录。并且根据层级的变化判断他的父目录。如果层级是递增的，那么文件的上一级目录就是他前面那个，否则则还要回头找到他的父目录。比如层级0,1,2,3,2,3,4
则第二个2的父目录不是前面的3,而是前面的1。根据文件数据生成FCB后，还需要设置好他的父目录parent和他的子目录children（在他的子文件设置父目录时进行）。


#### saveFileArea（）与loadFileArea（）函数：

如果文件位示图中显示某个物理块被占用，则将在写入本地磁盘文件fileArea中，随之写入的还有他的物理块号。而加载时则按行扫描fileArea，并且从中读取文件数据以及对应的物理块号，写在本文件管理系统的特定物理块上。


# 项目界面展示
>这里的图片都混乱了,就删除了,可以运行源码,或者看word版查看效果
## 目录操作

##   创建文件夹


##    删除文件夹


##   更改路径


## 文件操作

##   创建删除文件


##   读写文件

##  文件系统查看操作

## 保存与加载操作

>   退出程序：
>   重新启动程序：


## 其他操作

>   格式化：
>   帮助文档：


